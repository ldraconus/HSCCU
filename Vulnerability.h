#ifndef VULNERABILITY_H
#define VULNERABILITY_H

#include "complication.h"

class Vulnerability: public Complication
{
public:
    Vulnerability(): Complication() { }
    Vulnerability(const Vulnerability& ac)
        : Complication()
        , _attack(ac._attack)
        , _effect(ac._effect)
        , _what(ac._what) { }
    Vulnerability(Vulnerability&& ac)
        : Complication()
        , _attack(ac._attack)
        , _effect(ac._effect)
        , _what(ac._what) { }
    Vulnerability(const QJsonObject& json)
        : Complication()
        , _attack(json["attack"].toInt(0))
        , _effect(json["effect"].toInt(0))
        , _what(json["what"].toString("")) { }

    Vulnerability& operator=(const Vulnerability& ac) {
        if (this != &ac) {
            _attack = ac._attack;
            _effect = ac._effect;
            _what   = ac._what;
        }
        return *this;
    }
    Vulnerability& operator=(Vulnerability&& ac) {
        _attack = ac._attack;
        _effect = ac._effect;
        _what   = ac._what;
        return *this;
    }

    QString description() override {
        static QList<QString> attk { "Uncommon", "Common", "Very Common" };
        if (_attack == -1 ||  _what.isEmpty()) return "<incomplete>";
        return QString("Vulnerability: %1 (2x %2)").arg(_what, attk[_attack], _effect ? "Effect" : "Damage");
    }
    void form(QWidget* parent, QVBoxLayout* layout) override {
        what   = createLineEdit(parent, layout, "What are you vulnerable to?");
        attack = createComboBox(parent, layout, "How common is the attack", { "Uncommmon", "Common", "Very Common" });
        effect = createCheckBox(parent, layout, "Effect");
    }
    int points(bool noStore = false) override {
        if (!noStore) store();
        return 2 * _attack * 5;
    }
    void restore() override {
        what->setText(_what);
        attack->setCurrentIndex(_attack);
        effect->setChecked(_effect);
    }
    void store() override {
        _what   = what->text();
        _attack = attack->currentIndex();
        _effect = effect->isChecked();
    }
    QJsonObject toJson() override {
        QJsonObject obj;
        obj["name"]   = "Vulnerability";
        obj["attack"] = _attack;
        obj["effect"] = _effect;
        obj["what"]   = _what;
        return obj;
    }

private:
    int     _attack = -1;
    int     _effect = false;
    QString _what = "";

    QComboBox* attack;
    QCheckBox* effect;
    QLineEdit* what;
};

#endif // VULNERABILITY_H
